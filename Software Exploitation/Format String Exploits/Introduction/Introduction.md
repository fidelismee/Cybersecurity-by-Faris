Hackers are the wizards of the digital age. By now, you are a hacker yourself, but there is still room for your skills to grow. Have you mastered the truly occult? The deep, secret knowledge passed down from generation to secretive generation? The power to truly take control of complex software with cutting-edge security mitigations, and bend it to your will... Push on, now, into the depths of security, and use this dojo to fill your stores of the arcane knowledge that will power your digital sorcery.

# 📝 Notes: Format String Exploit – Leaking a Secret

### 🔹 The Program

```c
char *secret_value = "My secret value";
printf(fmt_str, 0xBEEF1337);
```

- `fmt_str` is user-controlled → directly passed into `printf`.
    
- Only **one real argument** (`0xBEEF1337`) is provided.
    

---

### 🔹 How `printf` Works

- Each format specifier (`%p`, `%s`, `%x`, etc.) consumes an argument.
    
- If the format string has **more specifiers than arguments**, `printf` will:
    
    - Keep reading values from the **stack** or **registers**.
        
    - Print whatever is there (addresses, garbage, or secrets).
        

---

### 🔹 Observed Leak

Command:

```bash
./a "leak: %p %p %p %p %p %p %p %p %s %p"
```

Output:

```
leak: 0xbeef1337 0x23 (nil) 0x7dfc9c61bf10 0x7dfc9c6f4040 \
      0x7ffec4aabf68 0x200000000 (nil) My secret value 0x7025203a6b61656c
```

- `0xbeef1337` → dummy argument.
    
- `0x23`, `(nil)` → garbage/NULL.
    
- `0x7dfc9c61bf10`, `0x7dfc9c6f4040` → heap/libc pointers.
    
- `0x7ffec4aabf68` → stack pointer.
    
- **`My secret value` → leaked via `%s`.**
    
- `0x7025203a6b61656c` → ASCII of `"leak: %p"`.
    

---

### 🔹 Why `%s` Leaked the Secret

- `%p` → prints raw pointer value.
    
- `%s` → interprets the next stack value as a **char*** and dereferences it.
    
- One of the stack slots contained the pointer to `"My secret value"`.
    
- `%s` followed it → secret printed.
    

---

### 🔹 Exploit Takeaways

- Format string vulnerabilities allow:
    
    - **Information leaks** (like secrets, addresses).
        
    - **Memory corruption** (via `%n`).
        
- Very dangerous in real-world programs.
    

---

### 🔹 Next Step

- Use **positional specifiers** (`%1$s`, `%2$s`, `%3$s`, …) to **pinpoint the exact stack offset** of the secret string instead of guessing.
    

---
